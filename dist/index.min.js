!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("core-js/fn/array/find"),require("core-js/fn/object/assign"),require("clone"),require("d3-ease"),require("d3-hierarchy"),require("prop-types"),require("react")):"function"==typeof define&&define.amd?define(["core-js/fn/array/find","core-js/fn/object/assign","clone","d3-ease","d3-hierarchy","prop-types","react"],t):(e=e||self).ReactTreeGraph=t(0,0,e.clone,e.d3,e.d3,e.PropTypes,e.React)}(this,function(e,t,c,r,l,n,h){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function d(o){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?p(Object(s),!0).forEach(function(e){var t,r,n;t=o,n=s[r=e],r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(s)):p(Object(s)).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(s,e))})}return o}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var P=/on[A-Z]/;function b(o){for(var e=arguments.length,s=new Array(1<e?e-1:0),t=1;t<e;t++)s[t-1]=arguments[t];var r=Object.keys(o).filter(function(e){return P.test(e)&&"function"==typeof o[e]}).reduce(function(e,t){var r,n;return e[t]=(r=o[t],n=s,function(e){return r.apply(void 0,[e].concat(m(n)))}),e},{});return d({},o,{},r)}var k={source:n.object.isRequired,target:n.object.isRequired,keyProp:n.string.isRequired,x1:n.number.isRequired,x2:n.number.isRequired,y1:n.number.isRequired,y2:n.number.isRequired,pathFunc:n.func.isRequired,pathProps:n.object.isRequired};var v={pathFunc:function(e,t,r,n){return"M".concat(t,",").concat(e,"C").concat((t+n)/2,",").concat(e," ").concat((t+n)/2,",").concat(r," ").concat(n,",").concat(r)}},q=function(){function e(){return s(this,e),g(this,f(e).apply(this,arguments))}return u(e,h.PureComponent),i(e,[{key:"render",value:function(){var e=b(this.props.pathProps,this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp]),t=this.props.pathFunc(this.props.x1,this.props.y1,this.props.x2,this.props.y2);return h.createElement("path",a({},e,{d:t}))}}]),e}();q.defaultProps=v,q.propTypes=k;var R={x:n.number.isRequired,y:n.number.isRequired,keyProp:n.string.isRequired,labelProp:n.string.isRequired,shape:n.string.isRequired,nodeProps:n.object.isRequired,partner:n.object,gProps:n.object.isRequired,textProps:n.object.isRequired},x=function(){function e(){return s(this,e),g(this,f(e).apply(this,arguments))}return u(e,h.PureComponent),i(e,[{key:"getTransform",value:function(){return"translate(".concat(this.props.y,", ").concat(this.props.x,")")}},{key:"render",value:function(){var e=0,t=this.props.nodeProps;switch(this.props.shape){case"circle":e=(t=d({r:5},t)).r;break;case"rect":t=d({height:10,width:10},t),e=(t=d({x:-t.width/2,y:-t.height/2},t)).width/2}var r=b(t,this.props[this.props.keyProp]),n=b(this.props.gProps,this.props[this.props.keyProp]),o=b(this.props.textProps,this.props[this.props.keyProp]);return h.createElement("g",a({},n,{transform:this.getTransform()}),h.createElement(this.props.shape,r),h.createElement("text",a({},o,{dx:e+.5}),!this.props.partner&&h.createElement("tspan",{dy:e},this.props[this.props.labelProp]),this.props.partner&&h.createElement("tspan",{dy:-e},this.props[this.props.labelProp]),this.props.partner&&h.createElement("tspan",{x:e+.5,dy:2.5*e},this.props.partner.name)))}}]),e}();x.propTypes=R;var j={children:n.node,partner:n.node,height:n.number.isRequired,keyProp:n.string.isRequired,labelProp:n.string.isRequired,links:n.array.isRequired,nodes:n.array.isRequired,nodeClassName:n.string,nodeShape:n.string.isRequired,nodeProps:n.object.isRequired,pathFunc:n.func,width:n.number.isRequired,gProps:n.object.isRequired,pathProps:n.object.isRequired,svgProps:n.object.isRequired,textProps:n.object.isRequired},w=function(){function e(){return s(this,e),g(this,f(e).apply(this,arguments))}return u(e,h.PureComponent),i(e,[{key:"render",value:function(){var t=this;return h.createElement("svg",a({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.children,h.createElement("g",null,this.props.links.map(function(e){return h.createElement(q,{key:e.target.data[t.props.keyProp],keyProp:t.props.keyProp,pathFunc:t.props.pathFunc,source:e.source,target:e.target,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y,pathProps:d({},t.props.pathProps,{},e.target.data.pathProps)})}),this.props.nodes.map(function(e){return h.createElement(x,a({key:e.data[t.props.keyProp],keyProp:t.props.keyProp,labelProp:t.props.labelProp,shape:t.props.nodeShape,x:e.x,y:e.y,nodeProps:d({},t.props.nodeProps,{},e.data.nodeProps),gProps:d({},t.props.gProps,{},e.data.gProps),textProps:d({},t.props.textProps,{},e.data.textProps)},e.data))})))}}]),e}();w.propTypes=j;var O={animated:n.bool.isRequired,getChildren:n.func.isRequired,keyProp:n.string.isRequired,links:n.array.isRequired,nodes:n.array.isRequired,duration:n.number.isRequired,easing:n.func.isRequired,steps:n.number.isRequired},C=function(){function o(e){var t;if(s(this,o),t=g(this,f(o).call(this,e)),e.animated){var r=e.nodes[0].x,n=e.nodes[0].y;t.state={nodes:e.nodes.map(function(e){return d({},e,{x:r,y:n})}),links:e.links.map(function(e){return{source:d({},e.source,{x:r,y:n}),target:d({},e.target,{x:r,y:n})}})}}else t.state={nodes:e.nodes,links:e.links};return t}return u(o,h.PureComponent),i(o,[{key:"componentDidMount",value:function(){this.props.animated&&this.animate(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.nodes===this.props.nodes&&e.links===this.props.links||(e.animated?this.animate(e):this.setState({nodes:e.nodes,links:e.links}))}},{key:"animate",value:function(e){var t=this;clearInterval(this.animation);var r=0,n=this.getAnimationContext(this.state,e);this.animation=setInterval(function(){if(++r===e.steps)return clearInterval(t.animation),t.animation=null,void t.setState({nodes:e.nodes,links:e.links});t.setState(t.calculateNewState(n,r/e.steps))},e.duration/e.steps)}},{key:"getAnimationContext",value:function(r,n){var o=this,e=n.nodes.filter(function(t){return r.nodes.every(function(e){return!o.areNodesSame(t,e)})}).map(function(e){return{base:e,old:o.getClosestAncestor(e,n,r),new:e}}),t=n.nodes.filter(function(t){return r.nodes.some(function(e){return o.areNodesSame(t,e)})}).map(function(t){return{base:t,old:r.nodes.find(function(e){return o.areNodesSame(t,e)}),new:t}}),s=r.nodes.filter(function(t){return n.nodes.every(function(e){return!o.areNodesSame(t,e)})}).map(function(e){return{base:e,old:e,new:o.getClosestAncestor(e,r,n)}}),i=n.links.filter(function(t){return r.links.every(function(e){return!o.areLinksSame(t,e)})}).map(function(e){return{base:e,old:o.getClosestAncestor(e.target,n,r),new:e}}),a=n.links.filter(function(t){return r.links.some(function(e){return o.areLinksSame(t,e)})}).map(function(t){return{base:t,old:r.links.find(function(e){return o.areLinksSame(t,e)}),new:t}}),p=r.links.filter(function(t){return n.links.every(function(e){return!o.areLinksSame(t,e)})}).map(function(e){return{base:e,old:e,new:o.getClosestAncestor(e.target,r,n)}});return{nodes:t.concat(e).concat(s),links:a.concat(i).concat(p)}}},{key:"getClosestAncestor",value:function(e,t,r){for(var n=this,o=e;o;){var s=r.nodes.find(function(e){return n.areNodesSame(o,e)});if(s)return s;o=t.nodes.find(function(e){return(n.props.getChildren(e)||[]).some(function(e){return n.areNodesSame(o,e)})})}return r.nodes[0]}},{key:"areNodesSame",value:function(e,t){return e.data[this.props.keyProp]===t.data[this.props.keyProp]}},{key:"areLinksSame",value:function(e,t){return e.source.data[this.props.keyProp]===t.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===t.target.data[this.props.keyProp]}},{key:"calculateNewState",value:function(e,t){var r=this;return{nodes:e.nodes.map(function(e){return r.calculateNodePosition(e.base,e.old,e.new,t)}),links:e.links.map(function(e){return r.calculateLinkPosition(e.base,e.old,e.new,t)})}}},{key:"calculateNodePosition",value:function(e,t,r,n){return d({},e,{x:this.calculateNewValue(t.x,r.x,n),y:this.calculateNewValue(t.y,r.y,n)})}},{key:"calculateLinkPosition",value:function(e,t,r,n){return{source:d({},e.source,{x:this.calculateNewValue(t.source?t.source.x:t.x,r.source?r.source.x:r.x,n),y:this.calculateNewValue(t.source?t.source.y:t.y,r.source?r.source.y:r.y,n)}),target:d({},e.target,{x:this.calculateNewValue(t.target?t.target.x:t.x,r.target?r.target.x:r.x,n),y:this.calculateNewValue(t.target?t.target.y:t.y,r.target?r.target.y:r.y,n)})}}},{key:"calculateNewValue",value:function(e,t,r){return e+(t-e)*this.props.easing(r)}},{key:"render",value:function(){return h.createElement(w,a({},this.props,this.state))}}]),o}();C.propTypes=O;var S={data:n.object.isRequired,animated:n.bool.isRequired,children:n.node,duration:n.number.isRequired,easing:n.func.isRequired,steps:n.number.isRequired,height:n.number.isRequired,width:n.number.isRequired,keyProp:n.string.isRequired,labelProp:n.string.isRequired,getChildren:n.func.isRequired,margins:n.shape({bottom:n.number.isRequired,left:n.number.isRequired,right:n.number.isRequired,top:n.number.isRequired}).isRequired,pathFunc:n.func,nodeShape:n.oneOf(["circle","rect","polygon"]).isRequired,nodeProps:n.object.isRequired,gProps:n.object.isRequired,pathProps:n.object.isRequired,svgProps:n.object.isRequired,textProps:n.object.isRequired},E={animated:!1,duration:500,easing:r.easeQuadOut,getChildren:function(e){return e.children},steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeShape:"circle",nodeProps:{},gProps:{},pathProps:{},svgProps:{},textProps:{}},N=function(){function e(){return s(this,e),g(this,f(e).apply(this,arguments))}return u(e,h.PureComponent),i(e,[{key:"childCountB",value:function(t,e,r){var n=this;e.children&&0<e.children.length&&(r.length<=t+1&&r.push(0),r[t+1]+=e.children.length,e.children.forEach(function(e){n.childCountB(t+1,e,r)}))}},{key:"childCountD",value:function(e,t){var r=this,n=t;return e.children&&0<e.children.length&&e.children.forEach(function(e){n=Math.max(n,r.childCountD(e,t+1))}),n}},{key:"render",value:function(){var t=this,e=this.props.width-this.props.margins.left-this.props.margins.right,r=this.props.height-this.props.margins.top-this.props.margins.bottom,n=l.hierarchy(c(this.props.data),this.props.getChildren),o=l.tree().size([r,e])(n),s=[1];this.childCountB(0,o,s);var i=70*Math.max.apply(Math,s),a=120*this.childCountD(o,1),p=(o=l.tree().size([Math.max(i,r),Math.max(a,0)])(n)).descendants(),u=o.links();return p.forEach(function(e){e.y+=t.props.margins.top}),h.createElement(C,{animated:this.props.animated,duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,links:u,nodes:p,nodeShape:this.props.nodeShape,nodeProps:this.props.nodeProps,pathFunc:this.props.pathFunc,steps:this.props.steps,width:this.props.width,gProps:d({className:"node"},this.props.gProps),pathProps:d({className:"link"},this.props.pathProps),svgProps:this.props.svgProps,textProps:this.props.textProps},this.props.children)}}]),e}();return N.propTypes=S,N.defaultProps=E,N});
